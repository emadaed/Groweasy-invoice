<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Invoice Preview</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .preview-container { border: 2px solid #ddd; padding: 20px; }
        .actions { margin-top: 20px; }
        .print-btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }
        .download-btn {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
        }

        /* Ensure all sections are visible */
        .invoice-preview * {
            visibility: visible !important;
            display: block !important;
        }

        /* Force show hidden elements */
        [style*="display:none"],
        [style*="display: none"],
        [hidden] {
            display: block !important;
            visibility: visible !important;
        }
    </style>
</head>
<body>
    <div class="preview-container">
        <h2>Document Preview</h2>

        <!-- Embed the actual invoice/PO HTML -->
        <div class="invoice-preview" id="preview-content">
            {{ html|safe }}
        </div>

        <!-- Hidden div with raw data for debugging -->
        <div style="display: none;" id="debug-data">
            {{ data|tojson }}
        </div>

        <div class="actions">
            <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print</button>
            <button class="download-btn" onclick="downloadPDF()">üì• Download PDF</button>
        </div>
    </div>

    <script>
        function downloadPDF() {
            const docType = window.location.pathname.includes('po') ? 'purchase_order' : 'invoice';
            const docNumber = '{{ data.invoice_number or data.po_number }}';

            window.location.href = `/invoice/download/${docNumber}?type=${docType}`;
        }

        // Fix any hidden elements in preview
        document.addEventListener('DOMContentLoaded', function() {
            // Force show all elements
            const allElements = document.querySelectorAll('#preview-content *');
            allElements.forEach(el => {
                el.style.visibility = 'visible';
                el.style.display = 'block';
                el.style.opacity = '1';

                // Remove any hiding classes
                el.classList.remove('d-none', 'hidden', 'collapse');
            });

            // Log preview data for debugging
            console.log('Preview data:', JSON.parse(document.getElementById('debug-data').textContent));
        });
    </script>
</body>
</html>