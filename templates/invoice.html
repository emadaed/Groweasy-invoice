{% extends "base.html" %}

{% block title %}Invoice Preview{% endblock %}

{% block content %}
{% include "components/_header.html" %}
{% include "components/_client_summary.html" %}
{% include "components/_items_table.html" %}
{% include "components/_totals.html" %}

{% if preview %}
<div class="text-center my-4">
  <form id="downloadForm" action="{{ url_for('download_invoice') }}" method="POST">
    <input type="hidden" name="data" id="downloadDataField">
    <button type="button" id="downloadBtn" class="btn btn-success px-4 py-2">
      ⬇️ Download PDF
    </button>
  </form>
</div>

<script>
(function() {
  const btn = document.getElementById('downloadBtn');
  const payload = {{ data | tojson | safe }};
  const qr = {{ qr_b64 | tojson | safe }};
  btn.addEventListener('click', function() {
    if (qr) payload.qr_b64 = qr;
    document.getElementById('downloadDataField').value = JSON.stringify(payload);
    document.getElementById('downloadForm').submit();
  });
})();
</script>
{% endif %}

{% include "components/_footer_qr.html" %}
{% endblock %}